import { __decorate } from "tslib";
import { Component, ElementRef, EventEmitter, HostBinding, HostListener, Input, OnChanges, OnInit, Renderer2, SimpleChanges } from "@angular/core";
import { DataService } from "./data.service";
import { defaultOptions } from "./options";
let NgPasswordValidatorComponent = class NgPasswordValidatorComponent {
    constructor(elementRef, renderer, dataService) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.dataService = dataService;
        this.passwordStatus = {
            password: false,
            "include-symbol": false,
            "include-number": false,
            "include-lowercase-characters": false,
            "include-uppercase-characters": false,
        };
        this.isSecure = false;
        this.Show = false;
        this.events = new EventEmitter();
        this.passwordOptions = Object.assign({}, defaultOptions);
    }
    /**
     * Host listener transition end
     *
     * @memberof NgPasswordValidatorComponent
     */
    transitionEnd() {
        if (this.show) {
            this.events.emit({
                type: "shown"
            });
        }
    }
    set show(value) {
        if (value) {
            this.setPosition();
        }
        this.Show = this.hostClassShow = value;
    }
    get show() {
        return this.Show;
    }
    get placement() {
        return this.data.options.placement;
    }
    get element() {
        return this.data.element;
    }
    get elementPosition() {
        return this.data.elementPosition;
    }
    get options() {
        return this.data.options;
    }
    get popupOffset() {
        switch (this.data.options.offset) {
            case "":
                return defaultOptions.offset;
            case "0":
                return +this.data.options.offset;
            default:
                return +this.data.options.offset;
        }
    }
    get rules() {
        return Object.assign(Object.assign({}, this.data.defaultOptions.rules), this.data.options.rules);
    }
    get defaultOptions() {
        return this.data.defaultOptions;
    }
    /**
     * Component initialization
     *
     * @memberof NgPasswordValidatorComponent
     */
    ngOnInit() {
        this.setCustomClass();
        this.setStyles();
        this.setTheme();
        this.setCustomText();
        this.dataService.updatedValue.subscribe((data) => {
            this.passwordStatus = Object.assign(Object.assign({}, this.passwordStatus), data);
            for (const propName in this.passwordOptions.rules) {
                if (!this.passwordOptions.rules[propName]) {
                    delete this.passwordStatus[propName];
                }
            }
            this.isSecure = Object.values(this.passwordStatus).every((value) => value);
        });
    }
    ngOnChanges(changes) {
        if (changes && changes.data && changes.data.currentValue) {
            this.data = changes.data.currentValue;
        }
    }
    /**
     * Set popup window position
     *
     * @returns {void}
     * @memberof NgPasswordValidatorComponent
     */
    setPosition() {
        if (this.setHostStyle(this.placement)) {
            this.setPlacementClass(this.placement);
            return;
        }
        else {
            // Is popup outside the visible area
            const placements = ["top", "right", "bottom", "left"];
            let isPlacementSet;
            for (const placement of placements) {
                if (this.setHostStyle(placement)) {
                    this.setPlacementClass(placement);
                    isPlacementSet = true;
                    return;
                }
            }
            // Set original placement
            if (!isPlacementSet) {
                this.setHostStyle(this.placement);
                this.setPlacementClass(this.placement);
            }
        }
    }
    /**
     * Set popup placement class
     *
     * @param {string} placement
     * @memberof NgPasswordValidatorComponent
     */
    setPlacementClass(placement) {
        this.renderer.addClass(this.elementRef.nativeElement, "popup-" + placement);
    }
    /**
     * Set host element style
     *
     * @param {string} placement
     * @returns {boolean}
     * @memberof NgPasswordValidatorComponent
     */
    setHostStyle(placement) {
        const isSvg = this.element instanceof SVGElement;
        const popup = this.elementRef.nativeElement;
        const isCustomPosition = !this.elementPosition.right;
        let elementHeight = isSvg ? this.element.getBoundingClientRect().height : this.element.offsetHeight;
        let elementWidth = isSvg ? this.element.getBoundingClientRect().width : this.element.offsetWidth;
        const popupHeight = popup.clientHeight;
        const popupWidth = popup.clientWidth;
        const scrollY = window.pageYOffset;
        if (isCustomPosition) {
            elementHeight = 0;
            elementWidth = 0;
        }
        let topStyle;
        let leftStyle;
        switch (placement) {
            case "top":
                topStyle = (this.elementPosition.top + scrollY) - (popupHeight + this.popupOffset);
                leftStyle = this.elementPosition.left;
                break;
            case "bottom":
                topStyle = (this.elementPosition.top + scrollY) + elementHeight + this.popupOffset;
                leftStyle = this.elementPosition.left;
                break;
            case "left":
                leftStyle = this.elementPosition.left - popupWidth - this.popupOffset;
                topStyle = (this.elementPosition.top + scrollY);
                break;
            case "right":
                leftStyle = this.elementPosition.left + elementWidth + this.popupOffset;
                topStyle = (this.elementPosition.top + scrollY);
        }
        this.hostStyleTop = topStyle + "px";
        this.hostStyleLeft = leftStyle + "px";
        return true;
    }
    /**
     * Sets Z-index
     *
     * @memberof NgPasswordValidatorComponent
     */
    setZIndex() {
        if (this.options["z-index"] !== 0) {
            this.hostStyleZIndex = this.options["z-index"];
        }
    }
    /**
     * Ste custom class name
     *
     * @memberof NgPasswordValidatorComponent
     */
    setCustomClass() {
        if (this.options["customClass"]) {
            this.options["customClass"].split(" ").forEach((className) => {
                this.renderer.addClass(this.elementRef.nativeElement, className);
            });
        }
    }
    /**
     * Set theme
     *
     * @memberof NgPasswordValidatorComponent
     */
    setTheme() {
        if (this.options["theme"]) {
            this.renderer.addClass(this.elementRef.nativeElement, "popup-" + this.options["theme"]);
        }
    }
    setCustomText() {
        if (this.options["heading"]) {
            this.heading = this.options["heading"];
        }
        if (this.options["successMessage"]) {
            this.successMessage = this.options["successMessage"];
        }
    }
    /**
     * Sets the animation duration
     *
     * @memberof NgPasswordValidatorComponent
     */
    setAnimationDuration() {
        this.hostStyleTransition = "opacity " + this.options["animation-duration"] + "ms";
    }
    /**
     * Set popup window style
     *
     * @memberof NgPasswordValidatorComponent
     */
    setStyles() {
        this.setZIndex();
        this.setAnimationDuration();
        this.hostClassShadow = this.options["shadow"];
        this.hostStyleMaxWidth = this.options["max-width"] + "px";
        this.hostStyleWidth = this.options["width"] ? this.options["width"] + "px" : "";
    }
};
NgPasswordValidatorComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: DataService }
];
__decorate([
    Input()
], NgPasswordValidatorComponent.prototype, "data", void 0);
__decorate([
    HostBinding("style.top")
], NgPasswordValidatorComponent.prototype, "hostStyleTop", void 0);
__decorate([
    HostBinding("style.left")
], NgPasswordValidatorComponent.prototype, "hostStyleLeft", void 0);
__decorate([
    HostBinding("style.z-index")
], NgPasswordValidatorComponent.prototype, "hostStyleZIndex", void 0);
__decorate([
    HostBinding("style.transition")
], NgPasswordValidatorComponent.prototype, "hostStyleTransition", void 0);
__decorate([
    HostBinding("style.width")
], NgPasswordValidatorComponent.prototype, "hostStyleWidth", void 0);
__decorate([
    HostBinding("style.max-width")
], NgPasswordValidatorComponent.prototype, "hostStyleMaxWidth", void 0);
__decorate([
    HostBinding("style.pointer-events")
], NgPasswordValidatorComponent.prototype, "hostStylePointerEvents", void 0);
__decorate([
    HostBinding("class.popup-show")
], NgPasswordValidatorComponent.prototype, "hostClassShow", void 0);
__decorate([
    HostBinding("class.popup-shadow")
], NgPasswordValidatorComponent.prototype, "hostClassShadow", void 0);
__decorate([
    HostListener("transitionend", [""])
], NgPasswordValidatorComponent.prototype, "transitionEnd", null);
__decorate([
    Input()
], NgPasswordValidatorComponent.prototype, "show", null);
NgPasswordValidatorComponent = __decorate([
    Component({
        selector: "NgPasswordValidator",
        template: "<div class=\"popup-window\">\n    <div class=\"heading\">{{heading}}</div>\n    <div *ngIf=\"rules['password']\">\n        <div class=\"rule\" [hidden]=\"rules['password'].type !== 'number'\"\n            [ngClass]=\"{'rule-pass':passwordStatus['password']}\">\n            Password length should be {{rules['password'].length}} characters.\n        </div>\n        <div class=\"rule\" [hidden]=\"rules['password'].type !== 'range'\"\n            [ngClass]=\"{'rule-pass':passwordStatus['password']}\">\n            Password length should be {{rules['password'].min}} - {{rules['password'].max}}\n            characters.\n        </div>\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-symbol']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-symbol']}\">\n        Include Symbols:( e.g. @#$% )\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-number']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-number']}\">\n        Include Numbers:( e.g.123456 )\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-lowercase-characters']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-lowercase-characters']}\">\n        Include Lowercase Characters:(e.g. abcdefgh )\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-uppercase-characters']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-uppercase-characters']}\">\n        Include Uppercase Characters:(e.g. ABCDEFGH )\n    </div>\n    <div class=\"success-message\" [hidden]=\"!isSecure\">\n        {{successMessage}}\n    </div>\n</div>\n",
        host: { class: "popup" },
        styles: ["@charset \"UTF-8\";:host{max-width:390px;background-color:#fff;color:#000;text-align:left;border-radius:6px;position:absolute;pointer-events:none;padding:10px;z-index:1000;display:block;opacity:0;transition:opacity .3s ease-in-out;top:0;left:0}:host.popup-show{opacity:1}:host.popup-shadow{box-shadow:0 1px 5px 0 rgba(0,0,0,.4)}:host.popup .popup-window .heading{font-size:16px;color:#000;margin-bottom:.5rem;font-weight:700}:host.popup .popup-window .rule{font-size:14px;color:#6a6a6a;line-height:18px;margin:3px 0}:host.popup .popup-window .rule::before{content:\"\\a\";width:5px;height:5px;border-radius:50%;background:#6a6a6a;display:inline-block;vertical-align:sub;margin:0 10px 6px 0}:host.popup .popup-window .rule.rule-pass{text-decoration:line-through;color:#d3d3d3}:host.popup .popup-window .rule.rule-pass::before{background:#d3d3d3}:host.popup .popup-window .success-message{color:#28a745;text-align:center;font-size:16px;margin-top:5px}:host.popup.popup-pro .popup-window .rule.rule-pass{color:#28a745;text-decoration:none}:host.popup.popup-pro .popup-window .rule.rule-pass::before{content:\"\u2713\"!important;width:0;height:0;padding-right:5px;vertical-align:inherit;background:#28a745}:host.popup.popup-pro .popup-window .success-message{color:#9c0404}"]
    })
], NgPasswordValidatorComponent);
export { NgPasswordValidatorComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctcGFzc3dvcmQtdmFsaWRhdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXBhc3N3b3JkLXZhbGlkYXRvci8iLCJzb3VyY2VzIjpbImxpYi9uZy1wYXNzd29yZC12YWxpZGF0b3IuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixTQUFTLEVBQ1QsYUFBYSxFQUNoQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQU8zQyxJQUFhLDRCQUE0QixHQUF6QyxNQUFhLDRCQUE0QjtJQXlGckMsWUFBb0IsVUFBc0IsRUFBVSxRQUFtQixFQUFVLFdBQXdCO1FBQXJGLGVBQVUsR0FBVixVQUFVLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUF0RnpHLG1CQUFjLEdBQUc7WUFDYixRQUFRLEVBQUUsS0FBSztZQUNmLGdCQUFnQixFQUFFLEtBQUs7WUFDdkIsZ0JBQWdCLEVBQUUsS0FBSztZQUN2Qiw4QkFBOEIsRUFBRSxLQUFLO1lBQ3JDLDhCQUE4QixFQUFFLEtBQUs7U0FDeEMsQ0FBQztRQUNGLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsU0FBSSxHQUFHLEtBQUssQ0FBQztRQUNiLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLG9CQUFlLHFCQUFvQyxjQUFjLEVBQUc7SUE0RXlDLENBQUM7SUE5RDlHOzs7O09BSUc7SUFFSCxhQUFhO1FBQ1QsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENB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VTtZQUFvQixTQUFTO1lBQXVCLFdBQVc7O0FBMUVoRztJQUFSLEtBQUssRUFBRTswREFBVztBQUVPO0lBQXpCLFdBQVcsQ0FBQyxXQUFXLENBQUM7a0VBQXNCO0FBQ3BCO0lBQTFCLFdBQVcsQ0FBQyxZQUFZLENBQUM7bUVBQXVCO0FBQ25CO0lBQTdCLFdBQVcsQ0FBQyxlQUFlLENBQUM7cUVBQXlCO0FBQ3JCO0lBQWhDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQzt5RUFBNkI7QUFDakM7SUFBM0IsV0FBVyxDQUFDLGFBQWEsQ0FBQztvRUFBd0I7QUFDbkI7SUFBL0IsV0FBVyxDQUFDLGlCQUFpQixDQUFDO3VFQUEyQjtBQUNyQjtJQUFwQyxXQUFXLENBQUMsc0JBQXNCLENBQUM7NEVBQWdDO0FBQ25DO0lBQWhDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQzttRUFBd0I7QUFDckI7SUFBbEMsV0FBVyxDQUFDLG9CQUFvQixDQUFDO3FFQUEwQjtBQVE1RDtJQURDLFlBQVksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztpRUFPbkM7QUFFUTtJQUFSLEtBQUssRUFBRTt3REFLUDtBQTlDUSw0QkFBNEI7SUFOeEMsU0FBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLHFCQUFxQjtRQUMvQiwrakRBQXFEO1FBQ3JELElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUU7O0tBRTNCLENBQUM7R0FDVyw0QkFBNEIsQ0E2UnhDO1NBN1JZLDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQ29tcG9uZW50LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIEhvc3RCaW5kaW5nLFxuICAgIEhvc3RMaXN0ZW5lcixcbiAgICBJbnB1dCxcbiAgICBPbkNoYW5nZXMsXG4gICAgT25Jbml0LFxuICAgIFJlbmRlcmVyMixcbiAgICBTaW1wbGVDaGFuZ2VzXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmltcG9ydCB7IERhdGFTZXJ2aWNlIH0gZnJvbSBcIi4vZGF0YS5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBJRWxlbWVudFBvc2l0aW9uLCBJUnVsZXMsIElTdGF0dXMsIE5nUGFzc3dvcmRWYWxpZGF0b3JPcHRpb25zIH0gZnJvbSBcIi4vbmctcGFzc3dvcmQtdmFsaWRhdG9yLmludGVyZmFjZVwiO1xuaW1wb3J0IHsgZGVmYXVsdE9wdGlvbnMgfSBmcm9tIFwiLi9vcHRpb25zXCI7XG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJOZ1Bhc3N3b3JkVmFsaWRhdG9yXCIsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9uZy1wYXNzd29yZC12YWxpZGF0b3IuY29tcG9uZW50Lmh0bWxcIixcbiAgICBob3N0OiB7IGNsYXNzOiBcInBvcHVwXCIgfSxcbiAgICBzdHlsZVVybHM6IFtcIi4vbmctcGFzc3dvcmQtdmFsaWRhdG9yLmNvbXBvbmVudC5zY3NzXCJdXG59KVxuZXhwb3J0IGNsYXNzIE5nUGFzc3dvcmRWYWxpZGF0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gICAgaGVhZGluZzogc3RyaW5nO1xuICAgIHN1Y2Nlc3NNZXNzYWdlOiBzdHJpbmc7XG4gICAgcGFzc3dvcmRTdGF0dXMgPSB7XG4gICAgICAgIHBhc3N3b3JkOiBmYWxzZSxcbiAgICAgICAgXCJpbmNsdWRlLXN5bWJvbFwiOiBmYWxzZSxcbiAgICAgICAgXCJpbmNsdWRlLW51bWJlclwiOiBmYWxzZSxcbiAgICAgICAgXCJpbmNsdWRlLWxvd2VyY2FzZS1jaGFyYWN0ZXJzXCI6IGZhbHNlLFxuICAgICAgICBcImluY2x1ZGUtdXBwZXJjYXNlLWNoYXJhY3RlcnNcIjogZmFsc2UsXG4gICAgfTtcbiAgICBpc1NlY3VyZSA9IGZhbHNlO1xuICAgIFNob3cgPSBmYWxzZTtcbiAgICBldmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgcGFzc3dvcmRPcHRpb25zOiBOZ1Bhc3N3b3JkVmFsaWRhdG9yT3B0aW9ucyA9IHsgLi4uZGVmYXVsdE9wdGlvbnMgfTtcblxuICAgIEBJbnB1dCgpIGRhdGE6IGFueTtcblxuICAgIEBIb3N0QmluZGluZyhcInN0eWxlLnRvcFwiKSBob3N0U3R5bGVUb3A6IHN0cmluZztcbiAgICBASG9zdEJpbmRpbmcoXCJzdHlsZS5sZWZ0XCIpIGhvc3RTdHlsZUxlZnQ6IHN0cmluZztcbiAgICBASG9zdEJpbmRpbmcoXCJzdHlsZS56LWluZGV4XCIpIGhvc3RTdHlsZVpJbmRleDogbnVtYmVyO1xuICAgIEBIb3N0QmluZGluZyhcInN0eWxlLnRyYW5zaXRpb25cIikgaG9zdFN0eWxlVHJhbnNpdGlvbjogc3RyaW5nO1xuICAgIEBIb3N0QmluZGluZyhcInN0eWxlLndpZHRoXCIpIGhvc3RTdHlsZVdpZHRoOiBzdHJpbmc7XG4gICAgQEhvc3RCaW5kaW5nKFwic3R5bGUubWF4LXdpZHRoXCIpIGhvc3RTdHlsZU1heFdpZHRoOiBzdHJpbmc7XG4gICAgQEhvc3RCaW5kaW5nKFwic3R5bGUucG9pbnRlci1ldmVudHNcIikgaG9zdFN0eWxlUG9pbnRlckV2ZW50czogc3RyaW5nO1xuICAgIEBIb3N0QmluZGluZyhcImNsYXNzLnBvcHVwLXNob3dcIikgaG9zdENsYXNzU2hvdzogYm9vbGVhbjtcbiAgICBASG9zdEJpbmRpbmcoXCJjbGFzcy5wb3B1cC1zaGFkb3dcIikgaG9zdENsYXNzU2hhZG93OiBib29sZWFuO1xuXG4gICAgLyoqXG4gICAgICogSG9zdCBsaXN0ZW5lciB0cmFuc2l0aW9uIGVuZFxuICAgICAqXG4gICAgICogQG1lbWJlcm9mIE5nUGFzc3dvcmRWYWxpZGF0b3JDb21wb25lbnRcbiAgICAgKi9cbiAgICBASG9zdExpc3RlbmVyKFwidHJhbnNpdGlvbmVuZFwiLCBbXCJcIl0pXG4gICAgdHJhbnNpdGlvbkVuZCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuc2hvdykge1xuICAgICAgICAgICAgdGhpcy5ldmVudHMuZW1pdCh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJzaG93blwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBJbnB1dCgpIHNldCBzaG93KHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuU2hvdyA9IHRoaXMuaG9zdENsYXNzU2hvdyA9IHZhbHVlO1xuICAgIH1cblxuICAgIGdldCBzaG93KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5TaG93O1xuICAgIH1cblxuICAgIGdldCBwbGFjZW1lbnQoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5vcHRpb25zLnBsYWNlbWVudDtcbiAgICB9XG5cbiAgICBnZXQgZWxlbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5lbGVtZW50O1xuICAgIH1cblxuICAgIGdldCBlbGVtZW50UG9zaXRpb24oKTogSUVsZW1lbnRQb3NpdGlvbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuZWxlbWVudFBvc2l0aW9uO1xuICAgIH1cblxuICAgIGdldCBvcHRpb25zKCk6IE5nUGFzc3dvcmRWYWxpZGF0b3JPcHRpb25zIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5vcHRpb25zO1xuICAgIH1cblxuICAgIGdldCBwb3B1cE9mZnNldCgpOiBudW1iZXIge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuZGF0YS5vcHRpb25zLm9mZnNldCkge1xuICAgICAgICAgICAgY2FzZSBcIlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZhdWx0T3B0aW9ucy5vZmZzZXQ7XG5cbiAgICAgICAgICAgIGNhc2UgXCIwXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuICt0aGlzLmRhdGEub3B0aW9ucy5vZmZzZXQ7XG5cbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuICt0aGlzLmRhdGEub3B0aW9ucy5vZmZzZXQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgcnVsZXMoKTogSVJ1bGVzIHtcbiAgICAgICAgcmV0dXJuIHsgLi4udGhpcy5kYXRhLmRlZmF1bHRPcHRpb25zLnJ1bGVzLCAuLi4gdGhpcy5kYXRhLm9wdGlvbnMucnVsZXMgfTtcbiAgICB9XG5cbiAgICBnZXQgZGVmYXVsdE9wdGlvbnMoKTogTmdQYXNzd29yZFZhbGlkYXRvck9wdGlvbnMge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmRlZmF1bHRPcHRpb25zO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGRhdGFTZXJ2aWNlOiBEYXRhU2VydmljZSkgeyB9XG5cbiAgICAvKipcbiAgICAgKiBDb21wb25lbnQgaW5pdGlhbGl6YXRpb25cbiAgICAgKlxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc2V0Q3VzdG9tQ2xhc3MoKTtcbiAgICAgICAgdGhpcy5zZXRTdHlsZXMoKTtcbiAgICAgICAgdGhpcy5zZXRUaGVtZSgpO1xuICAgICAgICB0aGlzLnNldEN1c3RvbVRleHQoKTtcbiAgICAgICAgdGhpcy5kYXRhU2VydmljZS51cGRhdGVkVmFsdWUuc3Vic2NyaWJlKChkYXRhOiBJU3RhdHVzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBhc3N3b3JkU3RhdHVzID0geyAuLi4gdGhpcy5wYXNzd29yZFN0YXR1cywgLi4uZGF0YSB9O1xuICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wTmFtZSBpbiB0aGlzLnBhc3N3b3JkT3B0aW9ucy5ydWxlcykge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5wYXNzd29yZE9wdGlvbnMucnVsZXNbcHJvcE5hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBhc3N3b3JkU3RhdHVzW3Byb3BOYW1lXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmlzU2VjdXJlID0gT2JqZWN0LnZhbHVlcyh0aGlzLnBhc3N3b3JkU3RhdHVzKS5ldmVyeSgodmFsdWU6IGJvb2xlYW4pID0+IHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgICAgICBpZiAoY2hhbmdlcyAmJiBjaGFuZ2VzLmRhdGEgJiYgY2hhbmdlcy5kYXRhLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gY2hhbmdlcy5kYXRhLmN1cnJlbnRWYWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCBwb3B1cCB3aW5kb3cgcG9zaXRpb25cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHt2b2lkfVxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgc2V0UG9zaXRpb24oKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnNldEhvc3RTdHlsZSh0aGlzLnBsYWNlbWVudCkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UGxhY2VtZW50Q2xhc3ModGhpcy5wbGFjZW1lbnQpO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJcyBwb3B1cCBvdXRzaWRlIHRoZSB2aXNpYmxlIGFyZWFcbiAgICAgICAgICAgIGNvbnN0IHBsYWNlbWVudHMgPSBbXCJ0b3BcIiwgXCJyaWdodFwiLCBcImJvdHRvbVwiLCBcImxlZnRcIl07XG4gICAgICAgICAgICBsZXQgaXNQbGFjZW1lbnRTZXQ7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgcGxhY2VtZW50IG9mIHBsYWNlbWVudHMpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXRIb3N0U3R5bGUocGxhY2VtZW50KSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBsYWNlbWVudENsYXNzKHBsYWNlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIGlzUGxhY2VtZW50U2V0ID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgb3JpZ2luYWwgcGxhY2VtZW50XG4gICAgICAgICAgICBpZiAoIWlzUGxhY2VtZW50U2V0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRIb3N0U3R5bGUodGhpcy5wbGFjZW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0UGxhY2VtZW50Q2xhc3ModGhpcy5wbGFjZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHBvcHVwIHBsYWNlbWVudCBjbGFzc1xuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHBsYWNlbWVudFxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgc2V0UGxhY2VtZW50Q2xhc3MocGxhY2VtZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgXCJwb3B1cC1cIiArIHBsYWNlbWVudCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IGhvc3QgZWxlbWVudCBzdHlsZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHBsYWNlbWVudFxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgc2V0SG9zdFN0eWxlKHBsYWNlbWVudDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGlzU3ZnID0gdGhpcy5lbGVtZW50IGluc3RhbmNlb2YgU1ZHRWxlbWVudDtcbiAgICAgICAgY29uc3QgcG9wdXAgPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgY29uc3QgaXNDdXN0b21Qb3NpdGlvbiA9ICF0aGlzLmVsZW1lbnRQb3NpdGlvbi5yaWdodDtcblxuICAgICAgICBsZXQgZWxlbWVudEhlaWdodCA9IGlzU3ZnID8gdGhpcy5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCA6IHRoaXMuZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIGxldCBlbGVtZW50V2lkdGggPSBpc1N2ZyA/IHRoaXMuZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCA6IHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgICAgY29uc3QgcG9wdXBIZWlnaHQgPSBwb3B1cC5jbGllbnRIZWlnaHQ7XG4gICAgICAgIGNvbnN0IHBvcHVwV2lkdGggPSBwb3B1cC5jbGllbnRXaWR0aDtcbiAgICAgICAgY29uc3Qgc2Nyb2xsWSA9IHdpbmRvdy5wYWdlWU9mZnNldDtcblxuICAgICAgICBpZiAoaXNDdXN0b21Qb3NpdGlvbikge1xuICAgICAgICAgICAgZWxlbWVudEhlaWdodCA9IDA7XG4gICAgICAgICAgICBlbGVtZW50V2lkdGggPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvcFN0eWxlO1xuICAgICAgICBsZXQgbGVmdFN0eWxlO1xuXG4gICAgICAgIHN3aXRjaCAocGxhY2VtZW50KSB7XG4gICAgICAgICAgICBjYXNlIFwidG9wXCI6XG4gICAgICAgICAgICAgICAgdG9wU3R5bGUgPSAodGhpcy5lbGVtZW50UG9zaXRpb24udG9wICsgc2Nyb2xsWSkgLSAocG9wdXBIZWlnaHQgKyB0aGlzLnBvcHVwT2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBsZWZ0U3R5bGUgPSB0aGlzLmVsZW1lbnRQb3NpdGlvbi5sZWZ0O1xuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJib3R0b21cIjpcbiAgICAgICAgICAgICAgICB0b3BTdHlsZSA9ICh0aGlzLmVsZW1lbnRQb3NpdGlvbi50b3AgKyBzY3JvbGxZKSArIGVsZW1lbnRIZWlnaHQgKyB0aGlzLnBvcHVwT2Zmc2V0O1xuICAgICAgICAgICAgICAgIGxlZnRTdHlsZSA9IHRoaXMuZWxlbWVudFBvc2l0aW9uLmxlZnQ7XG5cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgICAgICAgICAgbGVmdFN0eWxlID0gdGhpcy5lbGVtZW50UG9zaXRpb24ubGVmdCAtIHBvcHVwV2lkdGggLSB0aGlzLnBvcHVwT2Zmc2V0O1xuICAgICAgICAgICAgICAgIHRvcFN0eWxlID0gKHRoaXMuZWxlbWVudFBvc2l0aW9uLnRvcCArIHNjcm9sbFkpO1xuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICAgICAgICAgIGxlZnRTdHlsZSA9IHRoaXMuZWxlbWVudFBvc2l0aW9uLmxlZnQgKyBlbGVtZW50V2lkdGggKyB0aGlzLnBvcHVwT2Zmc2V0O1xuICAgICAgICAgICAgICAgIHRvcFN0eWxlID0gKHRoaXMuZWxlbWVudFBvc2l0aW9uLnRvcCArIHNjcm9sbFkpO1xuXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhvc3RTdHlsZVRvcCA9IHRvcFN0eWxlICsgXCJweFwiO1xuICAgICAgICB0aGlzLmhvc3RTdHlsZUxlZnQgPSBsZWZ0U3R5bGUgKyBcInB4XCI7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBaLWluZGV4XG4gICAgICpcbiAgICAgKiBAbWVtYmVyb2YgTmdQYXNzd29yZFZhbGlkYXRvckNvbXBvbmVudFxuICAgICAqL1xuICAgIHNldFpJbmRleCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9uc1tcInotaW5kZXhcIl0gIT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuaG9zdFN0eWxlWkluZGV4ID0gdGhpcy5vcHRpb25zW1wiei1pbmRleFwiXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFN0ZSBjdXN0b20gY2xhc3MgbmFtZVxuICAgICAqXG4gICAgICogQG1lbWJlcm9mIE5nUGFzc3dvcmRWYWxpZGF0b3JDb21wb25lbnRcbiAgICAgKi9cbiAgICBzZXRDdXN0b21DbGFzcygpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9uc1tcImN1c3RvbUNsYXNzXCJdKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnNbXCJjdXN0b21DbGFzc1wiXS5zcGxpdChcIiBcIikuZm9yRWFjaCgoY2xhc3NOYW1lOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBjbGFzc05hbWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlbWVcbiAgICAgKlxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgc2V0VGhlbWUoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnNbXCJ0aGVtZVwiXSkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgXCJwb3B1cC1cIiArIHRoaXMub3B0aW9uc1tcInRoZW1lXCJdKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldEN1c3RvbVRleHQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnNbXCJoZWFkaW5nXCJdKSB7XG4gICAgICAgICAgICB0aGlzLmhlYWRpbmcgPSB0aGlzLm9wdGlvbnNbXCJoZWFkaW5nXCJdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9uc1tcInN1Y2Nlc3NNZXNzYWdlXCJdKSB7XG4gICAgICAgICAgICB0aGlzLnN1Y2Nlc3NNZXNzYWdlID0gdGhpcy5vcHRpb25zW1wic3VjY2Vzc01lc3NhZ2VcIl07XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGFuaW1hdGlvbiBkdXJhdGlvblxuICAgICAqXG4gICAgICogQG1lbWJlcm9mIE5nUGFzc3dvcmRWYWxpZGF0b3JDb21wb25lbnRcbiAgICAgKi9cbiAgICBzZXRBbmltYXRpb25EdXJhdGlvbigpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ob3N0U3R5bGVUcmFuc2l0aW9uID0gXCJvcGFjaXR5IFwiICsgdGhpcy5vcHRpb25zW1wiYW5pbWF0aW9uLWR1cmF0aW9uXCJdICsgXCJtc1wiO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCBwb3B1cCB3aW5kb3cgc3R5bGVcbiAgICAgKlxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgc2V0U3R5bGVzKCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldFpJbmRleCgpO1xuICAgICAgICB0aGlzLnNldEFuaW1hdGlvbkR1cmF0aW9uKCk7XG5cbiAgICAgICAgdGhpcy5ob3N0Q2xhc3NTaGFkb3cgPSB0aGlzLm9wdGlvbnNbXCJzaGFkb3dcIl07XG4gICAgICAgIHRoaXMuaG9zdFN0eWxlTWF4V2lkdGggPSB0aGlzLm9wdGlvbnNbXCJtYXgtd2lkdGhcIl0gKyBcInB4XCI7XG4gICAgICAgIHRoaXMuaG9zdFN0eWxlV2lkdGggPSB0aGlzLm9wdGlvbnNbXCJ3aWR0aFwiXSA/IHRoaXMub3B0aW9uc1tcIndpZHRoXCJdICsgXCJweFwiIDogXCJcIjtcbiAgICB9XG59XG4iXX0=