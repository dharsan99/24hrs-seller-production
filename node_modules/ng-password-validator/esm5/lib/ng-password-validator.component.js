import { __assign, __decorate, __values } from "tslib";
import { Component, ElementRef, EventEmitter, HostBinding, HostListener, Input, OnChanges, OnInit, Renderer2, SimpleChanges } from "@angular/core";
import { DataService } from "./data.service";
import { defaultOptions } from "./options";
var NgPasswordValidatorComponent = /** @class */ (function () {
    function NgPasswordValidatorComponent(elementRef, renderer, dataService) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.dataService = dataService;
        this.passwordStatus = {
            password: false,
            "include-symbol": false,
            "include-number": false,
            "include-lowercase-characters": false,
            "include-uppercase-characters": false,
        };
        this.isSecure = false;
        this.Show = false;
        this.events = new EventEmitter();
        this.passwordOptions = __assign({}, defaultOptions);
    }
    /**
     * Host listener transition end
     *
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.transitionEnd = function () {
        if (this.show) {
            this.events.emit({
                type: "shown"
            });
        }
    };
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "show", {
        get: function () {
            return this.Show;
        },
        set: function (value) {
            if (value) {
                this.setPosition();
            }
            this.Show = this.hostClassShow = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "placement", {
        get: function () {
            return this.data.options.placement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "element", {
        get: function () {
            return this.data.element;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "elementPosition", {
        get: function () {
            return this.data.elementPosition;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "options", {
        get: function () {
            return this.data.options;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "popupOffset", {
        get: function () {
            switch (this.data.options.offset) {
                case "":
                    return defaultOptions.offset;
                case "0":
                    return +this.data.options.offset;
                default:
                    return +this.data.options.offset;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "rules", {
        get: function () {
            return __assign(__assign({}, this.data.defaultOptions.rules), this.data.options.rules);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgPasswordValidatorComponent.prototype, "defaultOptions", {
        get: function () {
            return this.data.defaultOptions;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Component initialization
     *
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.setCustomClass();
        this.setStyles();
        this.setTheme();
        this.setCustomText();
        this.dataService.updatedValue.subscribe(function (data) {
            _this.passwordStatus = __assign(__assign({}, _this.passwordStatus), data);
            for (var propName in _this.passwordOptions.rules) {
                if (!_this.passwordOptions.rules[propName]) {
                    delete _this.passwordStatus[propName];
                }
            }
            _this.isSecure = Object.values(_this.passwordStatus).every(function (value) { return value; });
        });
    };
    NgPasswordValidatorComponent.prototype.ngOnChanges = function (changes) {
        if (changes && changes.data && changes.data.currentValue) {
            this.data = changes.data.currentValue;
        }
    };
    /**
     * Set popup window position
     *
     * @returns {void}
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setPosition = function () {
        var e_1, _a;
        if (this.setHostStyle(this.placement)) {
            this.setPlacementClass(this.placement);
            return;
        }
        else {
            // Is popup outside the visible area
            var placements = ["top", "right", "bottom", "left"];
            var isPlacementSet = void 0;
            try {
                for (var placements_1 = __values(placements), placements_1_1 = placements_1.next(); !placements_1_1.done; placements_1_1 = placements_1.next()) {
                    var placement = placements_1_1.value;
                    if (this.setHostStyle(placement)) {
                        this.setPlacementClass(placement);
                        isPlacementSet = true;
                        return;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (placements_1_1 && !placements_1_1.done && (_a = placements_1.return)) _a.call(placements_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            // Set original placement
            if (!isPlacementSet) {
                this.setHostStyle(this.placement);
                this.setPlacementClass(this.placement);
            }
        }
    };
    /**
     * Set popup placement class
     *
     * @param {string} placement
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setPlacementClass = function (placement) {
        this.renderer.addClass(this.elementRef.nativeElement, "popup-" + placement);
    };
    /**
     * Set host element style
     *
     * @param {string} placement
     * @returns {boolean}
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setHostStyle = function (placement) {
        var isSvg = this.element instanceof SVGElement;
        var popup = this.elementRef.nativeElement;
        var isCustomPosition = !this.elementPosition.right;
        var elementHeight = isSvg ? this.element.getBoundingClientRect().height : this.element.offsetHeight;
        var elementWidth = isSvg ? this.element.getBoundingClientRect().width : this.element.offsetWidth;
        var popupHeight = popup.clientHeight;
        var popupWidth = popup.clientWidth;
        var scrollY = window.pageYOffset;
        if (isCustomPosition) {
            elementHeight = 0;
            elementWidth = 0;
        }
        var topStyle;
        var leftStyle;
        switch (placement) {
            case "top":
                topStyle = (this.elementPosition.top + scrollY) - (popupHeight + this.popupOffset);
                leftStyle = this.elementPosition.left;
                break;
            case "bottom":
                topStyle = (this.elementPosition.top + scrollY) + elementHeight + this.popupOffset;
                leftStyle = this.elementPosition.left;
                break;
            case "left":
                leftStyle = this.elementPosition.left - popupWidth - this.popupOffset;
                topStyle = (this.elementPosition.top + scrollY);
                break;
            case "right":
                leftStyle = this.elementPosition.left + elementWidth + this.popupOffset;
                topStyle = (this.elementPosition.top + scrollY);
        }
        this.hostStyleTop = topStyle + "px";
        this.hostStyleLeft = leftStyle + "px";
        return true;
    };
    /**
     * Sets Z-index
     *
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setZIndex = function () {
        if (this.options["z-index"] !== 0) {
            this.hostStyleZIndex = this.options["z-index"];
        }
    };
    /**
     * Ste custom class name
     *
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setCustomClass = function () {
        var _this = this;
        if (this.options["customClass"]) {
            this.options["customClass"].split(" ").forEach(function (className) {
                _this.renderer.addClass(_this.elementRef.nativeElement, className);
            });
        }
    };
    /**
     * Set theme
     *
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setTheme = function () {
        if (this.options["theme"]) {
            this.renderer.addClass(this.elementRef.nativeElement, "popup-" + this.options["theme"]);
        }
    };
    NgPasswordValidatorComponent.prototype.setCustomText = function () {
        if (this.options["heading"]) {
            this.heading = this.options["heading"];
        }
        if (this.options["successMessage"]) {
            this.successMessage = this.options["successMessage"];
        }
    };
    /**
     * Sets the animation duration
     *
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setAnimationDuration = function () {
        this.hostStyleTransition = "opacity " + this.options["animation-duration"] + "ms";
    };
    /**
     * Set popup window style
     *
     * @memberof NgPasswordValidatorComponent
     */
    NgPasswordValidatorComponent.prototype.setStyles = function () {
        this.setZIndex();
        this.setAnimationDuration();
        this.hostClassShadow = this.options["shadow"];
        this.hostStyleMaxWidth = this.options["max-width"] + "px";
        this.hostStyleWidth = this.options["width"] ? this.options["width"] + "px" : "";
    };
    NgPasswordValidatorComponent.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: DataService }
    ]; };
    __decorate([
        Input()
    ], NgPasswordValidatorComponent.prototype, "data", void 0);
    __decorate([
        HostBinding("style.top")
    ], NgPasswordValidatorComponent.prototype, "hostStyleTop", void 0);
    __decorate([
        HostBinding("style.left")
    ], NgPasswordValidatorComponent.prototype, "hostStyleLeft", void 0);
    __decorate([
        HostBinding("style.z-index")
    ], NgPasswordValidatorComponent.prototype, "hostStyleZIndex", void 0);
    __decorate([
        HostBinding("style.transition")
    ], NgPasswordValidatorComponent.prototype, "hostStyleTransition", void 0);
    __decorate([
        HostBinding("style.width")
    ], NgPasswordValidatorComponent.prototype, "hostStyleWidth", void 0);
    __decorate([
        HostBinding("style.max-width")
    ], NgPasswordValidatorComponent.prototype, "hostStyleMaxWidth", void 0);
    __decorate([
        HostBinding("style.pointer-events")
    ], NgPasswordValidatorComponent.prototype, "hostStylePointerEvents", void 0);
    __decorate([
        HostBinding("class.popup-show")
    ], NgPasswordValidatorComponent.prototype, "hostClassShow", void 0);
    __decorate([
        HostBinding("class.popup-shadow")
    ], NgPasswordValidatorComponent.prototype, "hostClassShadow", void 0);
    __decorate([
        HostListener("transitionend", [""])
    ], NgPasswordValidatorComponent.prototype, "transitionEnd", null);
    __decorate([
        Input()
    ], NgPasswordValidatorComponent.prototype, "show", null);
    NgPasswordValidatorComponent = __decorate([
        Component({
            selector: "NgPasswordValidator",
            template: "<div class=\"popup-window\">\n    <div class=\"heading\">{{heading}}</div>\n    <div *ngIf=\"rules['password']\">\n        <div class=\"rule\" [hidden]=\"rules['password'].type !== 'number'\"\n            [ngClass]=\"{'rule-pass':passwordStatus['password']}\">\n            Password length should be {{rules['password'].length}} characters.\n        </div>\n        <div class=\"rule\" [hidden]=\"rules['password'].type !== 'range'\"\n            [ngClass]=\"{'rule-pass':passwordStatus['password']}\">\n            Password length should be {{rules['password'].min}} - {{rules['password'].max}}\n            characters.\n        </div>\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-symbol']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-symbol']}\">\n        Include Symbols:( e.g. @#$% )\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-number']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-number']}\">\n        Include Numbers:( e.g.123456 )\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-lowercase-characters']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-lowercase-characters']}\">\n        Include Lowercase Characters:(e.g. abcdefgh )\n    </div>\n    <div class=\"rule\" [hidden]=\"!rules['include-uppercase-characters']\"\n        [ngClass]=\"{'rule-pass':passwordStatus['include-uppercase-characters']}\">\n        Include Uppercase Characters:(e.g. ABCDEFGH )\n    </div>\n    <div class=\"success-message\" [hidden]=\"!isSecure\">\n        {{successMessage}}\n    </div>\n</div>\n",
            host: { class: "popup" },
            styles: ["@charset \"UTF-8\";:host{max-width:390px;background-color:#fff;color:#000;text-align:left;border-radius:6px;position:absolute;pointer-events:none;padding:10px;z-index:1000;display:block;opacity:0;transition:opacity .3s ease-in-out;top:0;left:0}:host.popup-show{opacity:1}:host.popup-shadow{box-shadow:0 1px 5px 0 rgba(0,0,0,.4)}:host.popup .popup-window .heading{font-size:16px;color:#000;margin-bottom:.5rem;font-weight:700}:host.popup .popup-window .rule{font-size:14px;color:#6a6a6a;line-height:18px;margin:3px 0}:host.popup .popup-window .rule::before{content:\"\\a\";width:5px;height:5px;border-radius:50%;background:#6a6a6a;display:inline-block;vertical-align:sub;margin:0 10px 6px 0}:host.popup .popup-window .rule.rule-pass{text-decoration:line-through;color:#d3d3d3}:host.popup .popup-window .rule.rule-pass::before{background:#d3d3d3}:host.popup .popup-window .success-message{color:#28a745;text-align:center;font-size:16px;margin-top:5px}:host.popup.popup-pro .popup-window .rule.rule-pass{color:#28a745;text-decoration:none}:host.popup.popup-pro .popup-window .rule.rule-pass::before{content:\"\u2713\"!important;width:0;height:0;padding-right:5px;vertical-align:inherit;background:#28a745}:host.popup.popup-pro .popup-window .success-message{color:#9c0404}"]
        })
    ], NgPasswordValidatorComponent);
    return NgPasswordValidatorComponent;
}());
export { NgPasswordValidatorComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctcGFzc3dvcmQtdmFsaWRhdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXBhc3N3b3JkLXZhbGlkYXRvci8iLCJzb3VyY2VzIjpbImxpYi9uZy1wYXNzd29yZC12YWxpZGF0b3IuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0gsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksRUFDWixLQUFLLEVBQ0wsU0FBUyxFQUNULE1BQU0sRUFDTixTQUFTLEVBQ1QsYUFBYSxFQUNoQixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFN0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQU8zQztJQXlGSSxzQ0FBb0IsVUFBc0IsRUFBVSxRQUFtQixFQUFVLFdBQXdCO1FBQXJGLGVBQVUsR0FBVixVQUFVLENBQVk7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUF0RnpHLG1CQUFjLEdBQUc7WUFDYixRQUFRLEVBQUUsS0FBSztZQUNmLGdCQUFnQixFQUFFLEtBQUs7WUFDdkIsZ0JBQWdCLEVBQUUsS0FBSztZQUN2Qiw4QkFBOEIsRUFBRSxLQUFLO1lBQ3JDLDhCQUE4QixFQUFFLEtBQUs7U0FDeEMsQ0FBQztRQUNGLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsU0FBSSxHQUFHLEtBQUssQ0FBQztRQUNiLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLG9CQUFlLGdCQUFvQyxjQUFjLEVBQUc7SUE0RXlDLENBQUM7SUE5RDlHOzs7O09BSUc7SUFFSCxvREFBYSxHQUFiO1FBQ0ksSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1gsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQ2IsSUFBSSxFQUFFLE9BQU87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bXBvcnQge1xuICAgIENvbXBvbmVudCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBIb3N0QmluZGluZyxcbiAgICBIb3N0TGlzdGVuZXIsXG4gICAgSW5wdXQsXG4gICAgT25DaGFuZ2VzLFxuICAgIE9uSW5pdCxcbiAgICBSZW5kZXJlcjIsXG4gICAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBEYXRhU2VydmljZSB9IGZyb20gXCIuL2RhdGEuc2VydmljZVwiO1xuaW1wb3J0IHsgSUVsZW1lbnRQb3NpdGlvbiwgSVJ1bGVzLCBJU3RhdHVzLCBOZ1Bhc3N3b3JkVmFsaWRhdG9yT3B0aW9ucyB9IGZyb20gXCIuL25nLXBhc3N3b3JkLXZhbGlkYXRvci5pbnRlcmZhY2VcIjtcbmltcG9ydCB7IGRlZmF1bHRPcHRpb25zIH0gZnJvbSBcIi4vb3B0aW9uc1wiO1xuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwiTmdQYXNzd29yZFZhbGlkYXRvclwiLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vbmctcGFzc3dvcmQtdmFsaWRhdG9yLmNvbXBvbmVudC5odG1sXCIsXG4gICAgaG9zdDogeyBjbGFzczogXCJwb3B1cFwiIH0sXG4gICAgc3R5bGVVcmxzOiBbXCIuL25nLXBhc3N3b3JkLXZhbGlkYXRvci5jb21wb25lbnQuc2Nzc1wiXVxufSlcbmV4cG9ydCBjbGFzcyBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICAgIGhlYWRpbmc6IHN0cmluZztcbiAgICBzdWNjZXNzTWVzc2FnZTogc3RyaW5nO1xuICAgIHBhc3N3b3JkU3RhdHVzID0ge1xuICAgICAgICBwYXNzd29yZDogZmFsc2UsXG4gICAgICAgIFwiaW5jbHVkZS1zeW1ib2xcIjogZmFsc2UsXG4gICAgICAgIFwiaW5jbHVkZS1udW1iZXJcIjogZmFsc2UsXG4gICAgICAgIFwiaW5jbHVkZS1sb3dlcmNhc2UtY2hhcmFjdGVyc1wiOiBmYWxzZSxcbiAgICAgICAgXCJpbmNsdWRlLXVwcGVyY2FzZS1jaGFyYWN0ZXJzXCI6IGZhbHNlLFxuICAgIH07XG4gICAgaXNTZWN1cmUgPSBmYWxzZTtcbiAgICBTaG93ID0gZmFsc2U7XG4gICAgZXZlbnRzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHBhc3N3b3JkT3B0aW9uczogTmdQYXNzd29yZFZhbGlkYXRvck9wdGlvbnMgPSB7IC4uLmRlZmF1bHRPcHRpb25zIH07XG5cbiAgICBASW5wdXQoKSBkYXRhOiBhbnk7XG5cbiAgICBASG9zdEJpbmRpbmcoXCJzdHlsZS50b3BcIikgaG9zdFN0eWxlVG9wOiBzdHJpbmc7XG4gICAgQEhvc3RCaW5kaW5nKFwic3R5bGUubGVmdFwiKSBob3N0U3R5bGVMZWZ0OiBzdHJpbmc7XG4gICAgQEhvc3RCaW5kaW5nKFwic3R5bGUuei1pbmRleFwiKSBob3N0U3R5bGVaSW5kZXg6IG51bWJlcjtcbiAgICBASG9zdEJpbmRpbmcoXCJzdHlsZS50cmFuc2l0aW9uXCIpIGhvc3RTdHlsZVRyYW5zaXRpb246IHN0cmluZztcbiAgICBASG9zdEJpbmRpbmcoXCJzdHlsZS53aWR0aFwiKSBob3N0U3R5bGVXaWR0aDogc3RyaW5nO1xuICAgIEBIb3N0QmluZGluZyhcInN0eWxlLm1heC13aWR0aFwiKSBob3N0U3R5bGVNYXhXaWR0aDogc3RyaW5nO1xuICAgIEBIb3N0QmluZGluZyhcInN0eWxlLnBvaW50ZXItZXZlbnRzXCIpIGhvc3RTdHlsZVBvaW50ZXJFdmVudHM6IHN0cmluZztcbiAgICBASG9zdEJpbmRpbmcoXCJjbGFzcy5wb3B1cC1zaG93XCIpIGhvc3RDbGFzc1Nob3c6IGJvb2xlYW47XG4gICAgQEhvc3RCaW5kaW5nKFwiY2xhc3MucG9wdXAtc2hhZG93XCIpIGhvc3RDbGFzc1NoYWRvdzogYm9vbGVhbjtcblxuICAgIC8qKlxuICAgICAqIEhvc3QgbGlzdGVuZXIgdHJhbnNpdGlvbiBlbmRcbiAgICAgKlxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgQEhvc3RMaXN0ZW5lcihcInRyYW5zaXRpb25lbmRcIiwgW1wiXCJdKVxuICAgIHRyYW5zaXRpb25FbmQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLnNob3cpIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzLmVtaXQoe1xuICAgICAgICAgICAgICAgIHR5cGU6IFwic2hvd25cIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASW5wdXQoKSBzZXQgc2hvdyh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLlNob3cgPSB0aGlzLmhvc3RDbGFzc1Nob3cgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBnZXQgc2hvdygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuU2hvdztcbiAgICB9XG5cbiAgICBnZXQgcGxhY2VtZW50KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEub3B0aW9ucy5wbGFjZW1lbnQ7XG4gICAgfVxuXG4gICAgZ2V0IGVsZW1lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuZWxlbWVudDtcbiAgICB9XG5cbiAgICBnZXQgZWxlbWVudFBvc2l0aW9uKCk6IElFbGVtZW50UG9zaXRpb24ge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmVsZW1lbnRQb3NpdGlvbjtcbiAgICB9XG5cbiAgICBnZXQgb3B0aW9ucygpOiBOZ1Bhc3N3b3JkVmFsaWRhdG9yT3B0aW9ucyB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEub3B0aW9ucztcbiAgICB9XG5cbiAgICBnZXQgcG9wdXBPZmZzZXQoKTogbnVtYmVyIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLmRhdGEub3B0aW9ucy5vZmZzZXQpIHtcbiAgICAgICAgICAgIGNhc2UgXCJcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdE9wdGlvbnMub2Zmc2V0O1xuXG4gICAgICAgICAgICBjYXNlIFwiMFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiArdGhpcy5kYXRhLm9wdGlvbnMub2Zmc2V0O1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiArdGhpcy5kYXRhLm9wdGlvbnMub2Zmc2V0O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IHJ1bGVzKCk6IElSdWxlcyB7XG4gICAgICAgIHJldHVybiB7IC4uLnRoaXMuZGF0YS5kZWZhdWx0T3B0aW9ucy5ydWxlcywgLi4uIHRoaXMuZGF0YS5vcHRpb25zLnJ1bGVzIH07XG4gICAgfVxuXG4gICAgZ2V0IGRlZmF1bHRPcHRpb25zKCk6IE5nUGFzc3dvcmRWYWxpZGF0b3JPcHRpb25zIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5kZWZhdWx0T3B0aW9ucztcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBkYXRhU2VydmljZTogRGF0YVNlcnZpY2UpIHsgfVxuXG4gICAgLyoqXG4gICAgICogQ29tcG9uZW50IGluaXRpYWxpemF0aW9uXG4gICAgICpcbiAgICAgKiBAbWVtYmVyb2YgTmdQYXNzd29yZFZhbGlkYXRvckNvbXBvbmVudFxuICAgICAqL1xuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnNldEN1c3RvbUNsYXNzKCk7XG4gICAgICAgIHRoaXMuc2V0U3R5bGVzKCk7XG4gICAgICAgIHRoaXMuc2V0VGhlbWUoKTtcbiAgICAgICAgdGhpcy5zZXRDdXN0b21UZXh0KCk7XG4gICAgICAgIHRoaXMuZGF0YVNlcnZpY2UudXBkYXRlZFZhbHVlLnN1YnNjcmliZSgoZGF0YTogSVN0YXR1cykgPT4ge1xuICAgICAgICAgICAgdGhpcy5wYXNzd29yZFN0YXR1cyA9IHsgLi4uIHRoaXMucGFzc3dvcmRTdGF0dXMsIC4uLmRhdGEgfTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcE5hbWUgaW4gdGhpcy5wYXNzd29yZE9wdGlvbnMucnVsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucGFzc3dvcmRPcHRpb25zLnJ1bGVzW3Byb3BOYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5wYXNzd29yZFN0YXR1c1twcm9wTmFtZV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5pc1NlY3VyZSA9IE9iamVjdC52YWx1ZXModGhpcy5wYXNzd29yZFN0YXR1cykuZXZlcnkoKHZhbHVlOiBib29sZWFuKSA9PiB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgICAgaWYgKGNoYW5nZXMgJiYgY2hhbmdlcy5kYXRhICYmIGNoYW5nZXMuZGF0YS5jdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGNoYW5nZXMuZGF0YS5jdXJyZW50VmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgcG9wdXAgd2luZG93IHBvc2l0aW9uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7dm9pZH1cbiAgICAgKiBAbWVtYmVyb2YgTmdQYXNzd29yZFZhbGlkYXRvckNvbXBvbmVudFxuICAgICAqL1xuICAgIHNldFBvc2l0aW9uKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zZXRIb3N0U3R5bGUodGhpcy5wbGFjZW1lbnQpKSB7XG4gICAgICAgICAgICB0aGlzLnNldFBsYWNlbWVudENsYXNzKHRoaXMucGxhY2VtZW50KTtcblxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSXMgcG9wdXAgb3V0c2lkZSB0aGUgdmlzaWJsZSBhcmVhXG4gICAgICAgICAgICBjb25zdCBwbGFjZW1lbnRzID0gW1widG9wXCIsIFwicmlnaHRcIiwgXCJib3R0b21cIiwgXCJsZWZ0XCJdO1xuICAgICAgICAgICAgbGV0IGlzUGxhY2VtZW50U2V0O1xuXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHBsYWNlbWVudCBvZiBwbGFjZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0SG9zdFN0eWxlKHBsYWNlbWVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQbGFjZW1lbnRDbGFzcyhwbGFjZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICBpc1BsYWNlbWVudFNldCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gU2V0IG9yaWdpbmFsIHBsYWNlbWVudFxuICAgICAgICAgICAgaWYgKCFpc1BsYWNlbWVudFNldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0SG9zdFN0eWxlKHRoaXMucGxhY2VtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFBsYWNlbWVudENsYXNzKHRoaXMucGxhY2VtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCBwb3B1cCBwbGFjZW1lbnQgY2xhc3NcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwbGFjZW1lbnRcbiAgICAgKiBAbWVtYmVyb2YgTmdQYXNzd29yZFZhbGlkYXRvckNvbXBvbmVudFxuICAgICAqL1xuICAgIHNldFBsYWNlbWVudENsYXNzKHBsYWNlbWVudDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIFwicG9wdXAtXCIgKyBwbGFjZW1lbnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldCBob3N0IGVsZW1lbnQgc3R5bGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwbGFjZW1lbnRcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICAgKiBAbWVtYmVyb2YgTmdQYXNzd29yZFZhbGlkYXRvckNvbXBvbmVudFxuICAgICAqL1xuICAgIHNldEhvc3RTdHlsZShwbGFjZW1lbnQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBpc1N2ZyA9IHRoaXMuZWxlbWVudCBpbnN0YW5jZW9mIFNWR0VsZW1lbnQ7XG4gICAgICAgIGNvbnN0IHBvcHVwID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGlzQ3VzdG9tUG9zaXRpb24gPSAhdGhpcy5lbGVtZW50UG9zaXRpb24ucmlnaHQ7XG5cbiAgICAgICAgbGV0IGVsZW1lbnRIZWlnaHQgPSBpc1N2ZyA/IHRoaXMuZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgOiB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICBsZXQgZWxlbWVudFdpZHRoID0gaXNTdmcgPyB0aGlzLmVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggOiB0aGlzLmVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIGNvbnN0IHBvcHVwSGVpZ2h0ID0gcG9wdXAuY2xpZW50SGVpZ2h0O1xuICAgICAgICBjb25zdCBwb3B1cFdpZHRoID0gcG9wdXAuY2xpZW50V2lkdGg7XG4gICAgICAgIGNvbnN0IHNjcm9sbFkgPSB3aW5kb3cucGFnZVlPZmZzZXQ7XG5cbiAgICAgICAgaWYgKGlzQ3VzdG9tUG9zaXRpb24pIHtcbiAgICAgICAgICAgIGVsZW1lbnRIZWlnaHQgPSAwO1xuICAgICAgICAgICAgZWxlbWVudFdpZHRoID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0b3BTdHlsZTtcbiAgICAgICAgbGV0IGxlZnRTdHlsZTtcblxuICAgICAgICBzd2l0Y2ggKHBsYWNlbWVudCkge1xuICAgICAgICAgICAgY2FzZSBcInRvcFwiOlxuICAgICAgICAgICAgICAgIHRvcFN0eWxlID0gKHRoaXMuZWxlbWVudFBvc2l0aW9uLnRvcCArIHNjcm9sbFkpIC0gKHBvcHVwSGVpZ2h0ICsgdGhpcy5wb3B1cE9mZnNldCk7XG4gICAgICAgICAgICAgICAgbGVmdFN0eWxlID0gdGhpcy5lbGVtZW50UG9zaXRpb24ubGVmdDtcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwiYm90dG9tXCI6XG4gICAgICAgICAgICAgICAgdG9wU3R5bGUgPSAodGhpcy5lbGVtZW50UG9zaXRpb24udG9wICsgc2Nyb2xsWSkgKyBlbGVtZW50SGVpZ2h0ICsgdGhpcy5wb3B1cE9mZnNldDtcbiAgICAgICAgICAgICAgICBsZWZ0U3R5bGUgPSB0aGlzLmVsZW1lbnRQb3NpdGlvbi5sZWZ0O1xuXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICAgICAgICAgIGxlZnRTdHlsZSA9IHRoaXMuZWxlbWVudFBvc2l0aW9uLmxlZnQgLSBwb3B1cFdpZHRoIC0gdGhpcy5wb3B1cE9mZnNldDtcbiAgICAgICAgICAgICAgICB0b3BTdHlsZSA9ICh0aGlzLmVsZW1lbnRQb3NpdGlvbi50b3AgKyBzY3JvbGxZKTtcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwicmlnaHRcIjpcbiAgICAgICAgICAgICAgICBsZWZ0U3R5bGUgPSB0aGlzLmVsZW1lbnRQb3NpdGlvbi5sZWZ0ICsgZWxlbWVudFdpZHRoICsgdGhpcy5wb3B1cE9mZnNldDtcbiAgICAgICAgICAgICAgICB0b3BTdHlsZSA9ICh0aGlzLmVsZW1lbnRQb3NpdGlvbi50b3AgKyBzY3JvbGxZKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5ob3N0U3R5bGVUb3AgPSB0b3BTdHlsZSArIFwicHhcIjtcbiAgICAgICAgdGhpcy5ob3N0U3R5bGVMZWZ0ID0gbGVmdFN0eWxlICsgXCJweFwiO1xuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgWi1pbmRleFxuICAgICAqXG4gICAgICogQG1lbWJlcm9mIE5nUGFzc3dvcmRWYWxpZGF0b3JDb21wb25lbnRcbiAgICAgKi9cbiAgICBzZXRaSW5kZXgoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnNbXCJ6LWluZGV4XCJdICE9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmhvc3RTdHlsZVpJbmRleCA9IHRoaXMub3B0aW9uc1tcInotaW5kZXhcIl07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTdGUgY3VzdG9tIGNsYXNzIG5hbWVcbiAgICAgKlxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgc2V0Q3VzdG9tQ2xhc3MoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnNbXCJjdXN0b21DbGFzc1wiXSkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zW1wiY3VzdG9tQ2xhc3NcIl0uc3BsaXQoXCIgXCIpLmZvckVhY2goKGNsYXNzTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgY2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IHRoZW1lXG4gICAgICpcbiAgICAgKiBAbWVtYmVyb2YgTmdQYXNzd29yZFZhbGlkYXRvckNvbXBvbmVudFxuICAgICAqL1xuICAgIHNldFRoZW1lKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zW1widGhlbWVcIl0pIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsIFwicG9wdXAtXCIgKyB0aGlzLm9wdGlvbnNbXCJ0aGVtZVwiXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRDdXN0b21UZXh0KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zW1wiaGVhZGluZ1wiXSkge1xuICAgICAgICAgICAgdGhpcy5oZWFkaW5nID0gdGhpcy5vcHRpb25zW1wiaGVhZGluZ1wiXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnNbXCJzdWNjZXNzTWVzc2FnZVwiXSkge1xuICAgICAgICAgICAgdGhpcy5zdWNjZXNzTWVzc2FnZSA9IHRoaXMub3B0aW9uc1tcInN1Y2Nlc3NNZXNzYWdlXCJdO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBhbmltYXRpb24gZHVyYXRpb25cbiAgICAgKlxuICAgICAqIEBtZW1iZXJvZiBOZ1Bhc3N3b3JkVmFsaWRhdG9yQ29tcG9uZW50XG4gICAgICovXG4gICAgc2V0QW5pbWF0aW9uRHVyYXRpb24oKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaG9zdFN0eWxlVHJhbnNpdGlvbiA9IFwib3BhY2l0eSBcIiArIHRoaXMub3B0aW9uc1tcImFuaW1hdGlvbi1kdXJhdGlvblwiXSArIFwibXNcIjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgcG9wdXAgd2luZG93IHN0eWxlXG4gICAgICpcbiAgICAgKiBAbWVtYmVyb2YgTmdQYXNzd29yZFZhbGlkYXRvckNvbXBvbmVudFxuICAgICAqL1xuICAgIHNldFN0eWxlcygpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zZXRaSW5kZXgoKTtcbiAgICAgICAgdGhpcy5zZXRBbmltYXRpb25EdXJhdGlvbigpO1xuXG4gICAgICAgIHRoaXMuaG9zdENsYXNzU2hhZG93ID0gdGhpcy5vcHRpb25zW1wic2hhZG93XCJdO1xuICAgICAgICB0aGlzLmhvc3RTdHlsZU1heFdpZHRoID0gdGhpcy5vcHRpb25zW1wibWF4LXdpZHRoXCJdICsgXCJweFwiO1xuICAgICAgICB0aGlzLmhvc3RTdHlsZVdpZHRoID0gdGhpcy5vcHRpb25zW1wid2lkdGhcIl0gPyB0aGlzLm9wdGlvbnNbXCJ3aWR0aFwiXSArIFwicHhcIiA6IFwiXCI7XG4gICAgfVxufVxuIl19